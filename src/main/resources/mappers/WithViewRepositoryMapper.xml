<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.withbooks.web.repository.WithViewRepository">

<!-- 위드 전체 목록 조회 -->
<select id="findAll" resultType="WithView">
  select
        b.*,count(c.with_id) member_cnt
  from
        with_category a right join `with` b
        on a.with_id = b.id
        left join with_member c
        on b.id = c.with_id

  <where>
    <if test="categoryIds != null">
      a.category_id IN
      <foreach collection="categoryIds" item="arr"  open="(" close=")" separator=",">
        #{arr}
      </foreach>
    </if>
  </where>

  group by
          b.id;

<!--  카테고리 아이디 where 필요-->
</select>

  <select id="findAllByWithId" resultType="java.lang.String">
    select
          b.name category_name
    from
          with_category  a join book_category b
          on a.category_id = b.id
    where
          a.with_id =  #{withId}

  </select>




</mapper>

