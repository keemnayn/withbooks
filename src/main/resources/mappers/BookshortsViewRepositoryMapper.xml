<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.withbooks.web.repository.BookshortsViewRepository">

	<select id="findAll" resultType="BookshortsView" >

		select sv.*,
		IF(sl.user_id IS NULL, 0, 1) AS liked
		from shorts_view sv left join shorts_like sl
		on sv.id =sl.shorts_id and sl.user_id = #{userId}
		 <where>
        <if test="bookId != null">
            book_id = ${bookId}
        </if>
			 and
			 blind_yn = 0
    </where>

		order by id desc
		


	
				

		
	</select>

	<select id="findRand10" resultType="BookshortsView"
	>
		SELECT * FROM shorts_view where like_cnt >0 and blind_yn=0 ORDER BY RAND() LIMIT 10

	</select>

</mapper>